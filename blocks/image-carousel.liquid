{% comment %}
  ** Image Carousel Block **
  - Renders a Swiper.js carousel.
  - This file lives in the 'blocks' folder.
  - Includes autoplay.
  - Uses compatible array-building logic (no 'push').
{% endcomment %}

{% comment %}
  Build a comma-separated string of the setting keys for images that exist.
  This is a compatible way to build an array without the 'push' filter.
{% endcomment %}
{%- assign image_keys_string = "" -%}

{%- if block.settings.image_1 != blank -%}
  {%- assign image_keys_string = image_keys_string | append: "image_1," -%}
{%- endif -%}
{%- if block.settings.image_2 != blank -%}
  {%- assign image_keys_string = image_keys_string | append: "image_2," -%}
{%- endif -%}
{%- if block.settings.image_3 != blank -%}
  {%- assign image_keys_string = image_keys_string | append: "image_3," -%}
{%- endif -%}
{%- if block.settings.image_4 != blank -%}
  {%- assign image_keys_string = image_keys_string | append: "image_4," -%}
{%- endif -%}
{%- if block.settings.image_5 != blank -%}
  {%- assign image_keys_string = image_keys_string | append: "image_5," -%}
{%- endif -%}
{%- if block.settings.image_6 != blank -%}
  {%- assign image_keys_string = image_keys_string | append: "image_6," -%}
{%- endif -%}

{% comment %}
  Split the string into an array of keys.
{% endcomment %}
{%- assign carousel_image_keys = image_keys_string | split: "," -%}


{%- if carousel_image_keys.size > 0 -%}
  <div class="custom-image-carousel-block" {{ block.shopify_attributes }}>
    <div class="swiper-container image-carousel-{{ block.id }}">
      <div class="swiper-wrapper">
        {% comment %}
          Loop through the array of keys and get the image object for each key.
        {% endcomment %}
        {%- for key in carousel_image_keys -%}
          {%- assign image = block.settings[key] -%}
          <div class="swiper-slide">
            <img
              src="{{ image | image_url: width: 1200 }}"
              alt="{{ image.alt | escape }}"
              width="{{ image.width }}"
              height="{{ image.height }}"
              loading="lazy"
              style="width: 100%; height: 100%; object-fit: cover;"
            >
          </div>
        {%- endfor -%}
      </div>
      
      <div class="swiper-pagination"></div>
      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>
    </div>
  </div>
{%- else -%}
  <div {{ block.shopify_attributes }}>
    <p>Please add images to the carousel block.</p>
  </div>
{%- endif -%}

<style>
  .custom-image-carousel-block {
    padding-top: {{ block.settings.padding_top }}px;
    padding-bottom: {{ block.settings.padding_bottom }}px;
  }
  .image-carousel-{{ block.id }} {
    width: 100%;
    height: {{ block.settings.carousel_height }}px;
    position: relative;
    overflow: hidden;
  }
  /* Style for navigation arrows */
  .image-carousel-{{ block.id }} .swiper-button-next,
  .image-carousel-{{ block.id }} .swiper-button-prev {
    color: #ffffff; /* White arrows */
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 50%;
    width: 40px;
    height: 40px;
  }
  .image-carousel-{{ block.id }} .swiper-button-next::after,
  .image-carousel-{{ block.id }} .swiper-button-prev::after {
    font-size: 18px; /* Smaller arrow icon */
  }
  /* Style for pagination dots */
  .image-carousel-{{ block.id }} .swiper-pagination-bullet {
    background: #ffffff;
    opacity: 0.7;
  }
  .image-carousel-{{ block.id }} .swiper-pagination-bullet-active {
    opacity: 1;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    if (typeof Swiper !== 'undefined') {
      const carousel_{{ block.id }} = new Swiper('.image-carousel-{{ block.id }}', {
        loop: true,
        speed: 800,
        
        // Autoplay is enabled
        autoplay: {
          delay: 5000,
          disableOnInteraction: false,
        },
        
        // Pagination dots
        pagination: {
          el: '.swiper-pagination',
          clickable: true,
        },

        // Navigation arrows
        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev',
        },
      });
    } else {
      console.warn('Swiper library is not loaded. Carousel cannot be initialized.');
    }
  });
</script>

{% schema %}
{
  "name": "Image Carousel",
  "settings": [
    {
      "type": "header",
      "content": "Carousel Images"
    },
    {
      "type": "image_picker",
      "id": "image_1",
      "label": "Image 1"
    },
    {
      "type": "image_picker",
      "id": "image_2",
      "label": "Image 2"
    },
    {
      "type": "image_picker",
      "id": "image_3",
      "label": "Image 3"
    },
    {
      "type": "image_picker",
      "id": "image_4",
      "label": "Image 4 (Optional)"
    },
    {
      "type": "image_picker",
      "id": "image_5",
      "label": "Image 5 (Optional)"
    },
    {
      "type": "image_picker",
      "id": "image_6",
      "label": "Image 6 (Optional)"
    },
    {
      "type": "header",
      "content": "Sizing & Spacing"
    },
    {
      "type": "range",
      "id": "carousel_height",
      "min": 200,
      "max": 800,
      "step": 20,
      "unit": "px",
      "label": "Carousel Height",
      "default": 400
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Top Padding",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Bottom Padding",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "Image Carousel"
    }
  ]
}
{% endschema %}