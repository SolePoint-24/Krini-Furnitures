{%- comment -%}
  This section displays a title and a grid of clickable collection tiles.
  - Title text is configurable.
  - Tiles are created using blocks.
  - Tile colors are configurable.

  !! LAYOUT MERGED FROM 'FEATURES GRID' !!
  - Added full_width, color_scheme, and new padding settings.
  - Added new CSS for padding and full-width breakout.

  !! NEW !!
  - Added 'section_bg_color' setting to override the scheme background.
{%- endcomment -%}

{%- liquid
  assign s = section.settings
  assign heading_text_alignment = 'text-align: ' | append: s.heading_text_alignment | append: ';'
-%}

{%- comment -%}
  Assign CSS variables from section settings
{%- endcomment -%}
{%- style -%}
  /* CSS for padding classes (from Features Grid) */
  .padding-top-0 { padding-top: 0; }
  .padding-top-20 { padding-top: 20px; }
  .padding-top-40 { padding-top: 40px; }
  .padding-top-60 { padding-top: 60px; }
  .padding-top-80 { padding-top: 80px; }
  .padding-top-100 { padding-top: 100px; }

  .padding-bottom-0 { padding-bottom: 0; }
  .padding-bottom-20 { padding-bottom: 20px; }
  .padding-bottom-40 { padding-bottom: 40px; }
  .padding-bottom-60 { padding-bottom: 60px; }
  .padding-bottom-80 { padding-bottom: 80px; }
  .padding-bottom-100 { padding-bottom: 100px; }

  /* CSS for full width (from Features Grid) */
  .section--full-width {
    width: 100vw;
    margin-left: calc( (100% - 100vw) / 2 );
  }

  /* Original Collection Tile CSS */
  .collection-tiles-section-{{ section.id }} {
    /* Padding is now handled by classes on the main div */

    /* Apply custom background color if set */
    {%- if section.settings.section_bg_color != blank -%}
      background-color: {{ section.settings.section_bg_color }};
    {%- endif -%}

    /* Assign tile colors from pickers */
    --tile-bg-color: {{ section.settings.tile_bg_color }};
    --tile-text-color: {{ section.settings.tile_text_color }};
  }

  .collection-tiles__grid {
    display: grid;
    grid-template-columns: repeat({{ section.settings.columns_mobile }}, 1fr);
    gap: 1.5rem; /* 24px */
  }

  /* On medium screens and up, switch to desktop columns */
  @media screen and (min-width: 750px) {
    .collection-tiles__grid {
      grid-template-columns: repeat({{ section.settings.columns_desktop }}, 1fr);
    }
  }

  .collection-tile__link {
    display: block;
    /* Use variables from color pickers */
    background-color: var(--tile-bg-color);
    color: var(--tile-text-color);
    padding: 2.5rem 1.5rem; /* 40px 24px */
    border-radius: 12px;
    text-align: center;
    text-decoration: none;
    height: 100%;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .collection-tile__link:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
  }

  .collection-tile__title {
    font-size: 1.75rem; /* 28px */
    font-weight: 600;
    margin: 0 0 0.5rem 0;
    color: inherit; /* Inherit color from parent link */
  }

  .collection-tile__subtitle {
    font-size: 0.875rem; /* 14px */
    font-weight: 400;
    margin: 0;
    color: inherit; /* Inherit color from parent link */
    opacity: 0.9;
  }

  .collection-tiles__heading {
    text-align: center;
    margin-bottom: 2.5rem; /* 40px */
    {%- if section.settings.heading_color != blank -%}
      color: {{ section.settings.heading_color }};
    {%- endif -%}
  }
{%- endstyle -%}

<div
  class="collection-tiles-section-{{ section.id }} section color-{{ s.color_scheme }} padding-top-{{ s.padding_top }} padding-bottom-{{ s.padding_bottom }} {% if s.full_width %}section--full-width{% endif %}"
>
  <div class="page-width">
    {%- if section.settings.title != blank -%}
      <h2 class="collection-tiles__heading h2_style_2" style="{{ heading_text_alignment }}">
        {{ section.settings.title | escape }}
      </h2>
    {%- endif -%}

    {%- if section.blocks.size > 0 -%}
      <div class="collection-tiles__grid">
        {%- for block in section.blocks -%}
          {%- liquid
            assign collection = block.settings.collection
            assign tile_title = block.settings.title
            assign tile_subtitle = block.settings.subtitle

            if tile_title == blank and collection != blank
              assign tile_title = collection.title
            elsif tile_title == blank
              assign tile_title = "Collection Title"
            endif

            assign collection_url = collection.url | default: "#"
          -%}
          <div
            class="collection-tile__item"
            {{ block.shopify_attributes }}
          >
            <a href="{{ collection_url }}" class="collection-tile__link">
              <h3 class="collection-tile__title">{{ tile_title | escape }}</h3>
              {%- if tile_subtitle != blank -%}
                <p class="collection-tile__subtitle">{{ tile_subtitle | escape }}</p>
              {%- endif -%}
            </a>
          </div>
        {%- endfor -%}
      </div>
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "Collection Tiles Grid",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "color",
      "id": "section_bg_color",
      "label": "Custom Background Color",
      "info": "Optional. Overrides the background color from the Color Scheme."
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Make section full width",
      "default": true
    },
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Classes We Offer"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "info": "Leave blank to use the theme's default text color."
    },
    {
      "type": "select",
      "id": "heading_text_alignment",
      "label": "Heading Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Tile Colors"
    },
    {
      "type": "color",
      "id": "tile_bg_color",
      "label": "Tile Background Color",
      "default": "#223F29"
    },
    {
      "type": "color",
      "id": "tile_text_color",
      "label": "Tile Text Color",
      "default": "#FFFFFF"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 2,
      "max": 4,
      "step": 1,
      "label": "Columns on Desktop",
      "default": 2
    },
    {
      "type": "range",
      "id": "columns_mobile",
      "min": 1,
      "max": 5,
      "step": 1,
      "label": "Columns on Mobile",
      "default": 1
    },
    {
      "type": "range",
      "id":"padding_top",
      "min": 0,
      "max": 100,
      "step": 20,
      "unit": "px",
      "label": "Padding Top",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 20,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 40
    }
  ],
  "blocks": [
    {
      "type": "collection_tile",
      "name": "Collection Tile",
      "limit": 8,
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "info": "Leave blank to use the collection's title. Example: 'Painting Classes'"
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "Subtitle",
          "info": "Example: 'Age Group: 19+'"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Collection Tiles Grid",
      "blocks": [
        { "type": "collection_tile" },
        { "type": "collection_tile" },
        { "type": "collection_tile" },
        { "type": "collection_tile" }
      ]
    }
  ]
}
{% endschema %}