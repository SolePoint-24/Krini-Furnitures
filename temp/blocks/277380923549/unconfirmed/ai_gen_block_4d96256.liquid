{% doc %}
  @prompt
    Create a Liquid section named 'Catalog Download Modal'. The section should display a 'Get Catalog' button that opens a centered modal popup.
    
    Settings Requirements:
    
    A 'PDF File' URL picker for the catalog.
    
    A 'Custom HTML/App Embed' textarea setting to paste code from the Shopify Forms app.
    
    Text settings for headings and descriptions.
    
    Logic & Flow:
    
    If the 'Custom HTML' setting is filled, render that code inside the modal.
    
    If 'Custom HTML' is empty, render a native Shopify Contact form with fields: Name, Email, Mobile, Company.
    
    Crucial Feature: Inside the modal, below the form, always display a secondary button labeled 'Skip & Download PDF'. This allows users to download the file immediately without filling the form if they choose not to.
    
    If using the native form, ensure successful submission tags the customer with 'catalog-download' and then reveals the download button., did you sue the shopify-forms app form so icsn ust pass the id and you an get the feilds and all from there and then store them in that form can you do that rathere then the ciustom hrml and all and also add a heading too and add a downlod icon left side of the button 
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-catalog-section-{{ ai_gen_id }} {
    padding: {{ block.settings.section_padding }}px 20px;
    text-align: center;
    background-color: {{ block.settings.section_bg_color }};
  }

  .ai-catalog-heading-{{ ai_gen_id }} {
    margin: 0 0 24px;
    color: {{ block.settings.heading_color }};
    font-size: {{ block.settings.heading_size }}px;
  }

  .ai-catalog-modal-trigger-{{ ai_gen_id }} {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 16px 32px;
    background-color: {{ block.settings.button_bg_color }};
    color: {{ block.settings.button_text_color }};
    border: none;
    border-radius: {{ block.settings.button_border_radius }}px;
    font-size: {{ block.settings.button_font_size }}px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
  }

  .ai-catalog-modal-trigger-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_bg_color }};
    color: {{ block.settings.button_hover_text_color }};
  }

  .ai-catalog-button-icon-{{ ai_gen_id }} {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
  }

  .ai-catalog-modal-overlay-{{ ai_gen_id }} {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    z-index: 9998;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .ai-catalog-modal-overlay-{{ ai_gen_id }}.active {
    opacity: 1;
    visibility: visible;
  }

  .ai-catalog-modal-container-{{ ai_gen_id }} {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    width: 90%;
    max-width: {{ block.settings.modal_max_width }}px;
    max-height: 90vh;
    background-color: {{ block.settings.modal_bg_color }};
    border-radius: {{ block.settings.modal_border_radius }}px;
    z-index: 9999;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .ai-catalog-modal-container-{{ ai_gen_id }}.active {
    opacity: 1;
    visibility: visible;
    transform: translate(-50%, -50%) scale(1);
  }

  .ai-catalog-modal-header-{{ ai_gen_id }} {
    padding: 24px;
    border-bottom: 1px solid {{ block.settings.modal_border_color }};
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .ai-catalog-modal-title-{{ ai_gen_id }} {
    margin: 0;
    color: {{ block.settings.modal_text_color }};
    font-size: {{ block.settings.modal_heading_size }}px;
  }

  .ai-catalog-modal-close-{{ ai_gen_id }} {
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    color: {{ block.settings.modal_text_color }};
    opacity: 0.7;
    transition: opacity 0.2s ease;
  }

  .ai-catalog-modal-close-{{ ai_gen_id }}:hover {
    opacity: 1;
  }

  .ai-catalog-modal-body-{{ ai_gen_id }} {
    padding: 24px;
    overflow-y: auto;
    flex: 1;
  }

  .ai-catalog-modal-description-{{ ai_gen_id }} {
    color: {{ block.settings.modal_text_color }};
    margin-bottom: 24px;
    font-size: 14px;
    line-height: 1.6;
  }

  .ai-catalog-shopify-form-{{ ai_gen_id }} {
    margin-bottom: 24px;
  }

  .ai-catalog-skip-button-{{ ai_gen_id }} {
    width: 100%;
    padding: 14px 24px;
    background-color: transparent;
    color: {{ block.settings.modal_text_color }};
    border: 1px solid {{ block.settings.modal_text_color }};
    border-radius: {{ block.settings.button_border_radius }}px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 16px;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }

  .ai-catalog-skip-button-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.modal_text_color }};
    color: {{ block.settings.modal_bg_color }};
  }

  .ai-catalog-empty-state-{{ ai_gen_id }} {
    padding: 40px 20px;
    text-align: center;
    color: #999;
    font-size: 14px;
    font-style: italic;
  }

  @media screen and (max-width: 749px) {
    .ai-catalog-section-{{ ai_gen_id }} {
      padding: {{ block.settings.section_padding | times: 0.6 }}px 16px;
    }

    .ai-catalog-heading-{{ ai_gen_id }} {
      font-size: {{ block.settings.heading_size | times: 0.8 }}px;
    }

    .ai-catalog-modal-container-{{ ai_gen_id }} {
      width: 95%;
      max-height: 85vh;
    }

    .ai-catalog-modal-header-{{ ai_gen_id }},
    .ai-catalog-modal-body-{{ ai_gen_id }} {
      padding: 16px;
    }

    .ai-catalog-modal-title-{{ ai_gen_id }} {
      font-size: {{ block.settings.modal_heading_size | times: 0.8 }}px;
    }

    .ai-catalog-modal-trigger-{{ ai_gen_id }} {
      padding: 14px 24px;
      font-size: {{ block.settings.button_font_size | times: 0.9 }}px;
    }
  }
{% endstyle %}

<catalog-download-modal-{{ ai_gen_id }}
  class="ai-catalog-section-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
>
  {% if block.settings.section_heading != blank %}
    <h2 class="ai-catalog-heading-{{ ai_gen_id }}">{{ block.settings.section_heading }}</h2>
  {% endif %}

  <button
    class="ai-catalog-modal-trigger-{{ ai_gen_id }}"
    aria-label="{{ block.settings.button_text }}"
  >
    <svg
      class="ai-catalog-button-icon-{{ ai_gen_id }}"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
      <polyline points="7 10 12 15 17 10"></polyline>
      <line x1="12" y1="15" x2="12" y2="3"></line>
    </svg>
    {{ block.settings.button_text }}
  </button>

  <div class="ai-catalog-modal-overlay-{{ ai_gen_id }}"></div>

  <div class="ai-catalog-modal-container-{{ ai_gen_id }}">
    <div class="ai-catalog-modal-header-{{ ai_gen_id }}">
      <h2 class="ai-catalog-modal-title-{{ ai_gen_id }}">{{ block.settings.modal_heading }}</h2>
      <button
        class="ai-catalog-modal-close-{{ ai_gen_id }}"
        aria-label="Close modal"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="ai-catalog-modal-body-{{ ai_gen_id }}">
      {% if block.settings.modal_description != blank %}
        <div class="ai-catalog-modal-description-{{ ai_gen_id }}">
          {{ block.settings.modal_description }}
        </div>
      {% endif %}

      {% if block.settings.shopify_form_id != blank %}
        <div class="ai-catalog-shopify-form-{{ ai_gen_id }}">
          {{ block.settings.shopify_form_id }}
        </div>
      {% else %}
        <div class="ai-catalog-empty-state-{{ ai_gen_id }}">
          Next, add your Shopify Form ID in the block settings
        </div>
      {% endif %}

      {% if block.settings.pdf_url != blank %}
        <a
          href="{{ block.settings.pdf_url }}"
          class="ai-catalog-skip-button-{{ ai_gen_id }}"
          download
          target="_blank"
        >
          <svg
            width="20"
            height="20"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          {{ block.settings.skip_button_text }}
        </a>
      {% endif %}
    </div>
  </div>
</catalog-download-modal-{{ ai_gen_id }}>

<script>
  (function() {
    class CatalogDownloadModal{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
      }

      connectedCallback() {
        this.trigger = this.querySelector('.ai-catalog-modal-trigger-{{ ai_gen_id }}');
        this.overlay = this.querySelector('.ai-catalog-modal-overlay-{{ ai_gen_id }}');
        this.modal = this.querySelector('.ai-catalog-modal-container-{{ ai_gen_id }}');
        this.closeButton = this.querySelector('.ai-catalog-modal-close-{{ ai_gen_id }}');

        this.setupEventListeners();
      }

      setupEventListeners() {
        this.trigger.addEventListener('click', () => this.openModal());
        this.closeButton.addEventListener('click', () => this.closeModal());
        this.overlay.addEventListener('click', () => this.closeModal());

        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && this.modal.classList.contains('active')) {
            this.closeModal();
          }
        });
      }

      openModal() {
        this.overlay.classList.add('active');
        this.modal.classList.add('active');
        document.body.style.overflow = 'hidden';
      }

      closeModal() {
        this.overlay.classList.remove('active');
        this.modal.classList.remove('active');
        document.body.style.overflow = '';
      }
    }

    customElements.define('catalog-download-modal-{{ ai_gen_id }}', CatalogDownloadModal{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Catalog download modal",
  "settings": [
    {
      "type": "header",
      "content": "Section heading"
    },
    {
      "type": "text",
      "id": "section_heading",
      "label": "Heading",
      "default": "Download Our Catalog"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 32
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "section_padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Section padding",
      "default": 40
    },
    {
      "type": "color",
      "id": "section_bg_color",
      "label": "Section background",
      "default": "#f5f3ef"
    },
    {
      "type": "header",
      "content": "Trigger button"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Get Catalog"
    },
    {
      "type": "range",
      "id": "button_font_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Font size",
      "default": 16
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "label": "Border radius",
      "default": 8
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Background color",
      "default": "#c3cca6"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_hover_bg_color",
      "label": "Hover background color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_hover_text_color",
      "label": "Hover text color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Modal content"
    },
    {
      "type": "text",
      "id": "modal_heading",
      "label": "Modal heading",
      "default": "Download Our Catalog"
    },
    {
      "type": "range",
      "id": "modal_heading_size",
      "min": 16,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Modal heading size",
      "default": 24
    },
    {
      "type": "richtext",
      "id": "modal_description",
      "label": "Description",
      "default": "<p>Fill out the form below to receive our latest catalog.</p>"
    },
    {
      "type": "url",
      "id": "pdf_url",
      "label": "PDF file URL"
    },
    {
      "type": "header",
      "content": "Shopify form"
    },
    {
      "type": "html",
      "id": "shopify_form_id",
      "label": "Shopify form embed code",
      "info": "Paste the complete embed code from Shopify Forms app"
    },
    {
      "type": "header",
      "content": "Skip button"
    },
    {
      "type": "text",
      "id": "skip_button_text",
      "label": "Skip button text",
      "default": "Skip & Download PDF"
    },
    {
      "type": "header",
      "content": "Modal style"
    },
    {
      "type": "range",
      "id": "modal_max_width",
      "min": 400,
      "max": 800,
      "step": 50,
      "unit": "px",
      "label": "Maximum width",
      "default": 600
    },
    {
      "type": "range",
      "id": "modal_border_radius",
      "min": 0,
      "max": 24,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 12
    },
    {
      "type": "color",
      "id": "modal_bg_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "modal_text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "modal_border_color",
      "label": "Border color",
      "default": "#e6e6e6"
    }
  ],
  "presets": [
    {
      "name": "Catalog download modal"
    }
  ]
}
{% endschema %}
